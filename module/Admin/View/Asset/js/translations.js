"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var Translation=function(){function e(t){_classCallCheck(this,e),this.node=t,this.data_action=this.node.hasAttribute("data-action")?this.node.getAttribute("data-action"):window.location.href,this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.node.contentEditable=!0,this.node.spellcheck=!1,this.colorize(),this.watchChanges()}},{key:"colorize",value:function(){var t=(t=this.node.innerText).replace(/^(^[#;\|](?:(?![\n\[])[\s\S])*)/gim,'<span class="translation__comment">$1</span>');return this.node.innerHTML=t,!0}},{key:"watchChanges",value:function(){var t=this;return this.node.addEventListener("focusout",function(){t.postChanges(),t.colorize()}),!0}},{key:"postChanges",value:function(){var t,e=this;return null!=(t=this.node.closest(".spinner-action"))&&t.classList.add("spinner-action_active"),fetch(this.data_action,{method:"POST",body:this.getFormData()}).then(function(t){return t.json()}).then(function(t){SETTING.toast(t.status,t.message)}).catch(function(t){SETTING.toast("error",t)}).finally(function(){var t;null!=(t=e.node.closest(".spinner-action"))&&t.classList.remove("spinner-action_active")}),!0}},{key:"getFormData",value:function(){var t=new FormData;return t.set("body",this.node.innerText),t.set(SETTING.csrf.key,SETTING.csrf.token),t}}]),e}();document.querySelectorAll(".translation").forEach(function(t){new Translation(t)});