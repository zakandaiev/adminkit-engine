"use strict";function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,a){for(var e=0;e<a.length;e++){var i=a[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,a,e){return a&&_defineProperties(t.prototype,a),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var LoadMore=function(){function e(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.node=t,this.options=a,this.data_action=this.node.getAttribute("data-load-more"),this.data_method=this.node.hasAttribute("data-method")?this.node.getAttribute("data-method"):"POST",this.data_event=this.node.hasAttribute("data-event")?this.node.getAttribute("data-event"):"click",this.data_target=this.node.getAttribute("data-target"),this.data_target_position=this.node.hasAttribute("data-target-position")?this.node.getAttribute("data-target-position"):"beforeend",this.data_class=this.node.getAttribute("data-class"),this.data_class_target=this.node.getAttribute("data-class-target"),this.data_uri_key=this.node.hasAttribute("data-uri-key")?this.node.getAttribute("data-uri-key"):"page",this.data_page=this.node.hasAttribute("data-page")?parseInt(this.node.getAttribute("data-page")):1,this.data_total=parseInt(this.node.getAttribute("data-total")),this.pagination_limit=parseInt(null==(t=SETTING)?void 0:t.pagination_limit),this.data_output=null,this.data_page*this.pagination_limit>=this.data_total?this.node.remove():this.data_action&&this.data_target&&this.data_total&&this.pagination_limit&&this.initialize()}return _createClass(e,[{key:"initialize",value:function(){var a=this;this.node.addEventListener(this.data_event,function(t){t.preventDefault(),a.disableNodes();t=a.data_action+"?"+a.data_uri_key+"="+ ++a.data_page;fetch(t,{method:a.data_method,body:a.getFormData()}).then(function(t){return t.text()}).then(function(t){a.data_output=t,a.output()}).catch(function(t){SETTING.toast("error",t)}).finally(function(){a.enableNodes()})})}},{key:"getFormData",value:function(){var a=new FormData,t=[];return(t=this.options.data?t.concat(this.options.data):t).forEach(function(t){t.key&&a.set(t.key,t.value||null)}),a}},{key:"disableNodes",value:function(){var a=this;return this.node.setAttribute("disabled","disabled"),this.node.classList.add("disabled"),this.data_class&&this.data_class_target?document.querySelectorAll(this.data_class_target).forEach(function(t){t.classList.add(a.data_class)}):this.data_class&&this.node.classList.add(this.data_class),!0}},{key:"enableNodes",value:function(){var a=this;return this.node.removeAttribute("disabled","disabled"),this.node.classList.remove("disabled"),this.data_class&&this.data_class_target?document.querySelectorAll(this.data_class_target).forEach(function(t){t.classList.remove(a.data_class)}):this.data_class&&this.node.classList.remove(this.data_class),!0}},{key:"output",value:function(){var t=document.querySelector(this.data_target);return!(!t||!this.data_output)&&(t.insertAdjacentHTML(this.data_target_position,this.data_output),null!=(t=feather)&&t.replace(),this.data_page*this.pagination_limit>=this.data_total&&fadeOut(this.node),!0)}}]),e}();document.querySelectorAll("[data-load-more]").forEach(function(t){new LoadMore(t,{data:[{key:SETTING.csrf.key,value:SETTING.csrf.token}]})});