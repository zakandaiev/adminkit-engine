"use strict";const mainMenu=document.querySelector("ul.list-group.sortable"),addMenuItem=document.getElementById("menu-add-item"),addMenuItemBlank=document.getElementById("menu-item-blank");function editMenuItems(){var e=JSON.stringify(formatMenuItems(getMenuItems(mainMenu)));const t=document.querySelector(".spinner-action");t.classList.add("spinner-action_active");let n=new FormData;n.set("items",e),n.set(SETTING.csrf.key,SETTING.csrf.token),fetch(t.getAttribute("data-menu-action"),{method:"POST",body:n}).then(e=>e.json()).then(e=>{SETTING.toast(e.status,e.message)}).catch(e=>{SETTING.toast("error",e)}).finally(()=>{t.classList.remove("spinner-action_active")})}function getMenuItems(a){let r=[];return a.querySelectorAll(".menu-list").forEach(e=>{let t={name:"#",url:"#",parent:null,children:[]};var n=e.closest("ul.list-group.sortable");n!==a&&(t.parent=getItemProp(n.previousElementSibling,"name")),t.name=getItemProp(e,"name"),t.url=getItemProp(e,"url"),r.push(t)}),r}function formatMenuItems(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t={},n,a=[],r;for(r=0;r<e.length;r+=1)t[e[r].name]=r,e[r].children=[];for(r=0;r<e.length;r+=1)((n=e[r]).parent?e[t[n.parent]].children:a).push(n);return a}function getItemProp(e){var t;switch(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"name"){case"name":return null!=(t=null==(t=e.querySelector('.menu-item > input[name="name"]'))?void 0:t.value)?t:"";case"url":return null!=(t=null==(t=e.querySelector('.menu-item > input[name="url"]'))?void 0:t.value)?t:"";default:return null}}null!==addMenuItem&&void 0!==addMenuItem&&addMenuItem.addEventListener("click",e=>{e.preventDefault();const t=addMenuItemBlank.cloneNode(!0);t.classList.remove("hidden"),t.removeAttribute("id"),mainMenu.appendChild(t),makeSortable(t.querySelector(".sortable"))}),document.addEventListener("click",e=>{const t=e.target.closest(".menu-item__icon");t&&t.classList.contains("feather-trash")&&fadeOut(t.closest(".menu-list"),!1,"editMenuItems"),(e.target.closest("[data-bs-toggle]")||e.target.closest("[data-bs-toggle]"))&&e.preventDefault()}),document.addEventListener("focusout",e=>{e.target.classList.contains("menu-item__input")&&editMenuItems()});